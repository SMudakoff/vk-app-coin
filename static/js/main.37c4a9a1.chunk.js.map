{"version":3,"sources":["img/roll.svg","components/Sliders.js","panels/Home.js","panels/Intro.js","App.js","index.js"],"names":["module","exports","IS_TAPTIC_SUPPORTED","bridge","supports","throttle","callback","delay","args","context","isThrottled","wrapper","arguments","this","apply","setTimeout","Home","fetchedState","snackbarError","useState","hasOwnProperty","rollsCount","setRollsCount","toiletVisits","setToiletVisits","personsCount","setPersonsCount","sheetsCount","SHEETS_PER_ROLL","setSheetsCount","snackbar","setSnackbar","onSheet","a","send","type","layout","onClose","before","size","style","backgroundColor","fill","width","height","duration","newSheetsCount","newRollsCount","Math","floor","setStorage","properties","key","value","JSON","stringify","onRollsChange","rolls","onVisitsChange","visits","onPersonsChange","persons","className","sheetsPerDay","totalSheets","round","countDays","step","min","max","top","indicator","mode","role","aria-label","onChange","vertical","onClick","src","roll","alt","id","Sliders","Intro","go","route","fetchedUser","userHasSeenIntro","centered","photo_200","first_name","level","ROUTES","STORAGE_KEYS","App","activePanel","setActivePanel","setUser","setFetchedState","popout","setPopout","setUserHasSeenIntro","useEffect","user","keys","sheetState","Array","isArray","data","forEach","parse","hasSeenIntro","error","subscribe","detail","schemeAttribute","document","createAttribute","scheme","body","attributes","setNamedItem","fetchData","panel","viewIntro","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.37c4a9a1.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/roll.b528eaf8.svg\";","import React, { useState, Fragment } from 'react';\r\nimport Slider from '@vkontakte/vkui/dist/components/Slider/Slider';\r\nimport Header from '@vkontakte/vkui/dist/components/Header/Header';\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\r\nimport FixedLayout from '@vkontakte/vkui/dist/components/FixedLayout/FixedLayout';\r\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\r\nimport FormLayout from '@vkontakte/vkui/dist/components/FormLayout/FormLayout';\r\nimport Counter from '@vkontakte/vkui/dist/components/Counter/Counter';\r\nimport Snackbar from '@vkontakte/vkui/dist/components/Snackbar/Snackbar';\r\nimport Icon28DocumentOutline from '@vkontakte/icons/dist/28/document_outline';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport roll from '../img/roll.svg';\r\n\r\nconst SHEETS_PER_ROLL \t\t= 160;\r\nconst SHEETS_PER_VISIT \t\t= 7;\r\nconst DEFAULT_ROLLS_COUNT \t= 4;\r\nconst DEFAULT_TOILET_VISITS = 3;\r\nconst DEFAULT_PERSONS_COUNT = 2;\r\nconst IS_TAPTIC_SUPPORTED\t= bridge.supports('VKWebAppTapticNotificationOccurred');\r\n\r\nfunction throttle(callback, delay) {\r\n\tlet isThrottled = false, args, context;\r\n\r\n\tfunction wrapper() {\r\n\t\tif (isThrottled) {\r\n\t\t\targs = arguments;\r\n\t\t\tcontext = this;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tisThrottled = true;\r\n\t\tcallback.apply(this, arguments);\r\n\t\t\r\n\t\tsetTimeout(() => {\r\n\t\t\tisThrottled = false;\r\n\t\t\tif (args) {\r\n\t\t\t\twrapper.apply(context, args);\r\n\t\t\t\targs = context = null;\r\n\t\t\t}\r\n\t\t}, delay);\r\n\t}\r\n\treturn wrapper;\r\n}\r\n\r\nconst Home = ({ fetchedState, snackbarError }) => {\r\n\tconst [rollsCount, setRollsCount] = useState(fetchedState.hasOwnProperty('rollsCount') ? fetchedState.rollsCount : DEFAULT_ROLLS_COUNT);\r\n\tconst [toiletVisits, setToiletVisits] = useState(fetchedState.hasOwnProperty('toiletVisits') ? fetchedState.toiletVisits : DEFAULT_TOILET_VISITS);\r\n\tconst [personsCount, setPersonsCount] = useState(fetchedState.hasOwnProperty('personsCount') ? fetchedState.personsCount : DEFAULT_PERSONS_COUNT);\r\n\tconst [sheetsCount, setSheetsCount] = useState(fetchedState.hasOwnProperty('sheetsCount') ? fetchedState.sheetsCount : SHEETS_PER_ROLL * DEFAULT_ROLLS_COUNT);\r\n\tconst [snackbar, setSnackbar] = useState(snackbarError);\r\n\r\n\tconst onSheet = async function () {\r\n\t\tif (IS_TAPTIC_SUPPORTED) {\r\n\t\t\tawait bridge.send('VKWebAppTapticNotificationOccurred', { type: sheetsCount <= 0 ? 'error' : 'success' });\r\n\t\t}\r\n\t\tif (sheetsCount <= 0) {\r\n\t\t\tsetSnackbar(<Snackbar\r\n\t\t\t\tlayout='vertical'\r\n\t\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon28DocumentOutline fill='#fff' width={14} height={14} /></Avatar>}\r\n\t\t\t\tduration={900}\r\n\t\t\t>\r\n\t\t\t\tУ вас не осталось туалетки\r\n\t\t\t</Snackbar>);\r\n\t\t\tsetRollsCount(0);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst newSheetsCount = sheetsCount - 1;\r\n\t\tconst newRollsCount = Math.floor(newSheetsCount / SHEETS_PER_ROLL);\r\n\r\n\t\tsetSheetsCount(newSheetsCount);\r\n\t\tif (rollsCount !== newRollsCount && newRollsCount !== 0) {\r\n\t\t\tsetRollsCount(newRollsCount);\r\n\t\t}\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tlayout='vertical'\r\n\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon28DocumentOutline fill='#fff' width={14} height={14} /></Avatar>}\r\n\t\t\tduration={900}\r\n\t\t>\r\n\t\t\t{newSheetsCount <= 0 ? 'У вас не осталось туалетки' : `Листочек туалетки потрачен, осталось ${newSheetsCount}`}\r\n\t\t</Snackbar>);\r\n\t\tsetStorage({\r\n\t\t\tsheetsCount: newSheetsCount\r\n\t\t});\r\n\t}\r\n\r\n\tconst setStorage = async function(properties) {\r\n\t\tawait bridge.send('VKWebAppStorageSet', {\r\n\t\t\tkey: 'state',\r\n\t\t\tvalue: JSON.stringify({\r\n\t\t\t\trollsCount,\r\n\t\t\t\ttoiletVisits,\r\n\t\t\t\tpersonsCount,\r\n\t\t\t\tsheetsCount,\r\n\t\t\t\t...properties\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n\r\n\tconst countDays = function() {\r\n\t\tconst sheetsPerDay = SHEETS_PER_VISIT * toiletVisits * personsCount;\r\n\t\tconst totalSheets = rollsCount * SHEETS_PER_ROLL\r\n\t\treturn Math.round(totalSheets / sheetsPerDay);\r\n\t}\r\n\r\n\tconst onRollsChange = throttle(rolls => {\r\n\t\tif (rolls === rollsCount) return;\r\n\t\tsetSheetsCount(sheetsCount + (rolls - rollsCount) * SHEETS_PER_ROLL);\r\n\t\tsetRollsCount(rolls);\r\n\t\tsetStorage();\r\n\t}, 200);\r\n\r\n\tconst onVisitsChange = throttle(visits => {\r\n\t\tif (visits === toiletVisits) return;\r\n\t\tsetToiletVisits(visits)\r\n\t\tsetStorage();\r\n\t}, 200);\r\n\r\n\tconst onPersonsChange = throttle(persons => {\r\n\t\tif (persons === personsCount) return;\r\n\t\tsetPersonsCount(persons);\r\n\t\tsetStorage();\r\n\t}, 200);\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<Group>\r\n\t\t\t\t<h1 className='DaysLeftHeading'>{countDays()}</h1>\r\n\t\t\t\t<h3 className='DaysLeftSubheading'>Столько дней вы продержитесь</h3>\r\n\t\t\t</Group>\r\n\t\t\t<FormLayout>\r\n\t\t\t\t\t<Slider\r\n\t\t\t\t\t\tstep={1}\r\n\t\t\t\t\t\tmin={0}\r\n\t\t\t\t\t\tmax={48}\r\n\t\t\t\t\t\tvalue={rollsCount}\r\n\t\t\t\t\t\ttop={\r\n\t\t\t\t\t\t\t<Header indicator={<Counter size='m' mode='primary'>{rollsCount}</Counter>}>\r\n\t\t\t\t\t\t\t\t<span role='img' aria-label='Toilet paper'>🧻</span> Количество рулонов\r\n\t\t\t\t\t\t\t</Header>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tonChange={(rolls) => onRollsChange(rolls)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Slider\r\n\t\t\t\t\t\tstep={1}\r\n\t\t\t\t\t\tmin={1}\r\n\t\t\t\t\t\tmax={8}\r\n\t\t\t\t\t\tvalue={toiletVisits}\r\n\t\t\t\t\t\ttop={\r\n\t\t\t\t\t\t\t<Header indicator={<Counter size='m' mode='primary'>{toiletVisits}</Counter>}>\r\n\t\t\t\t\t\t\t\t<span role='img' aria-label='Poo'>💩</span> Посещений туалета в день\r\n\t\t\t\t\t\t\t</Header>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tonChange={visits => onVisitsChange(visits)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Slider\r\n\t\t\t\t\t\tstep={1}\r\n\t\t\t\t\t\tmin={1}\r\n\t\t\t\t\t\tmax={16}\r\n\t\t\t\t\t\tvalue={personsCount}\r\n\t\t\t\t\t\ttop={\r\n\t\t\t\t\t\t\t<Header indicator={<Counter size='m' mode='primary'>{personsCount}</Counter>}>\r\n\t\t\t\t\t\t\t\t<span role='img' aria-label='People in household'>👨‍👩‍👧‍👦</span> Людей дома\r\n\t\t\t\t\t\t\t</Header>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tonChange={persons => onPersonsChange(persons)}\r\n\t\t\t\t\t/>\r\n\t\t\t</FormLayout>\r\n\r\n\t\t\t<FixedLayout vertical=\"bottom\">\r\n\t\t\t\t<Div className='PooBtnContainer'>\r\n\t\t\t\t\t<Button  className='PooBtn' size='xl' onClick={onSheet}>\r\n\t\t\t\t\t\t<img src={roll} alt=\"Toilet paper roll\"/>\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</Div>\r\n\t\t\t</FixedLayout>\r\n\r\n\t\t\t{snackbar}\r\n\t\t</Fragment>\r\n\t);\r\n};\r\n\r\nexport default Home;\r\n","import React from 'react';\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport Sliders from '../components/Sliders';\r\n\r\nimport './Home.css';\r\n\r\nconst Home = ({ id, snackbarError, fetchedState }) => {\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader>Туалетка</PanelHeader>\r\n\t\t\t{fetchedState && <Sliders fetchedState={fetchedState} snackbarError={snackbarError} />}\r\n\t\t</Panel>\r\n\t);\r\n};\r\n\r\nexport default Home;\r\n","import React, { Fragment } from 'react';\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\r\nimport FixedLayout from '@vkontakte/vkui/dist/components/FixedLayout/FixedLayout';\r\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\r\n\r\nimport './Intro.css';\r\n\r\nconst Intro = ({ id, go, route, fetchedUser, userHasSeenIntro }) => (\r\n\t<Panel id={id} centered={true}>\r\n\t\t<PanelHeader>Туалетка</PanelHeader>\r\n\t\t{(fetchedUser && !userHasSeenIntro) &&\r\n\t\t\t<Fragment>\r\n\t\t\t\t<Group>\r\n\t\t\t\t\t<Div className='User'>\r\n\t\t\t\t\t\t{fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\r\n\t\t\t\t\t\t<h2>Привет, {fetchedUser.first_name}</h2>\r\n\t\t\t\t\t\t<h3>Этот сервис помогает следить за тем, чтобы туалетная бумага дома не заканчивалась и ты не попал в неловкую ситуацию, когда ее не окажется в самый нужный момент.</h3>\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t</Group>\r\n\t\t\t\t<FixedLayout vertical='bottom'>\r\n\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t<Button mode='commerce' size=\"xl\" level=\"2\" onClick={() => go(route)}>\r\n\t\t\t\t\t\t\tОК, всё понятно\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t</FixedLayout>\r\n\t\t\t</Fragment>\r\n\t\t}\r\n\t</Panel>\r\n);\r\nexport default Intro;\r\n","import React, { useState, useEffect } from 'react';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport Snackbar from '@vkontakte/vkui/dist/components/Snackbar/Snackbar';\r\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\r\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\r\nimport Icon24Error from '@vkontakte/icons/dist/24/error';\r\n\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\n\r\nimport Home from './panels/Home';\r\nimport Intro from './panels/Intro';\r\n\r\nconst ROUTES = {\r\n\tHOME: 'home',\r\n\tINTRO: 'intro',\r\n};\r\n\r\nconst STORAGE_KEYS = {\r\n\tSTATE: 'state',\r\n\tSTATUS: 'viewStatus',\r\n};\r\n\r\nconst App = () => {\r\n\tconst [activePanel, setActivePanel] = useState(ROUTES.INTRO);\r\n\tconst [fetchedUser, setUser] = useState(null);\r\n\tconst [fetchedState, setFetchedState] = useState(null);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [popout, setPopout] = useState(<ScreenSpinner size='large' />);\r\n\tconst [userHasSeenIntro, setUserHasSeenIntro] = useState(false);\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t\t\t}\r\n\t\t});\r\n\t\tasync function fetchData() {\r\n\t\t\tconst user = await bridge.send('VKWebAppGetUserInfo');\r\n\t\t\tconst sheetState = await bridge.send('VKWebAppStorageGet', { keys: [STORAGE_KEYS.STATE, STORAGE_KEYS.STATUS]});\r\n\t\t\tif (Array.isArray(sheetState.keys)) {\r\n\t\t\t\tconst data = {};\r\n\t\t\t\tsheetState.keys.forEach(({ key, value }) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdata[key] = value ? JSON.parse(value) : {};\r\n\t\t\t\t\t\tswitch (key) {\r\n\t\t\t\t\t\t\tcase STORAGE_KEYS.STATE:\r\n\t\t\t\t\t\t\t\tsetFetchedState(data[STORAGE_KEYS.STATE]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase STORAGE_KEYS.STATUS:\r\n\t\t\t\t\t\t\t\tif (data[key] && data[key].hasSeenIntro) {\r\n\t\t\t\t\t\t\t\t\tsetActivePanel(ROUTES.HOME);\r\n\t\t\t\t\t\t\t\t\tsetUserHasSeenIntro(true);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tsetSnackbar(<Snackbar\r\n\t\t\t\t\t\t\tlayout='vertical'\r\n\t\t\t\t\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\t\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--dynamic_red)'}}><Icon24Error fill='#fff' width={14} height={14} /></Avatar>}\r\n\t\t\t\t\t\t\tduration={900}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПроблема с получением данных из Storage\r\n\t\t\t\t\t\t</Snackbar>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tsetFetchedState({});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tsetFetchedState({});\r\n\t\t\t}\r\n\t\t\tsetUser(user);\r\n\t\t\tsetPopout(null);\r\n\t\t}\r\n\t\tfetchData();\r\n\t}, []);\r\n\r\n\tconst go = panel => {\r\n\t\tsetActivePanel(panel);\r\n\t};\r\n\r\n\tconst viewIntro = async (panel) => {\r\n\t\ttry {\r\n\t\t\tawait bridge.send('VKWebAppStorageSet', {\r\n\t\t\t\tkey: STORAGE_KEYS.STATUS,\r\n\t\t\t\tvalue: JSON.stringify({\r\n\t\t\t\t\thasSeenIntro: true,\r\n\t\t\t\t}),\r\n\t\t\t});\r\n\t\t\tgo(panel);\r\n\t\t} catch (error) {\r\n\t\t\tsetSnackbar(<Snackbar\r\n\t\t\t\tlayout='vertical'\r\n\t\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--dynamic_red)'}}><Icon24Error fill='#fff' width={14} height={14} /></Avatar>}\r\n\t\t\t\tduration={900}\r\n\t\t\t>\r\n\t\t\t\tПроблема с отправкой данных в Storage\r\n\t\t\t</Snackbar>\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<View activePanel={activePanel} popout={popout}>\r\n\t\t\t<Home id={ROUTES.HOME} fetchedState={fetchedState} snackbarError={snackbar} />\r\n\t\t\t<Intro id={ROUTES.INTRO} fetchedUser={fetchedUser} go={viewIntro} route={ROUTES.HOME} userHasSeenIntro={userHasSeenIntro} />\r\n\t\t</View>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n\r\n","import \"core-js/features/map\";\r\nimport \"core-js/features/set\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport App from \"./App\";\r\n\r\n// Init VK  Mini App\r\nbridge.send(\"VKWebAppInit\");\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\nif (process.env.NODE_ENV === \"development\") {\r\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\r\n}\r\n"],"sourceRoot":""}